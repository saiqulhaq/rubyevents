<% title hotwire_native_app? ? "RubyEvents" : "RubyEvents.org - On a mission to index all Ruby events" %>
<% content_for :body_class, "home-page" %>

<% if @featured_events.any? %>
  <% content_for :head do %>
    <meta name="theme-color" content="<%= @featured_events.first.static_metadata.featured_background %>" data-featured-theme-color>
    <style>
      :root {
        --featured-color: <%= @featured_events.first.static_metadata.featured_color %>;
        --featured-background: <%= @featured_events.first.static_metadata.featured_background %>;
      }

      body.home-page .navbar {
        background: var(--featured-background);
      }

      body.home-page .navbar .desktop-menu a,
      body.home-page .navbar > .container a:not(.dropdown-content a) {
        color: var(--featured-color);
      }

      body.home-page .navbar .dropdown-content a,
      body.home-page .navbar .dropdown-content button {
        color: #000 !important;
      }

      body.home-page .navbar .btn-primary {
        background-color: white;
        color: black;
        border: 1px solid rgb(156 163 175 / var(--tw-border-opacity, 1));
      }

      body.home-page .navbar .btn-primary:hover {
        background-color: rgba(255, 255, 255, 0.9);
      }

      body.home-page .navbar svg {
        fill: var(--featured-color);
      }

      .splide__track, .splide__list {
        background: transparent !important;
      }
      body.home-page .splide {
        background: var(--featured-background);
        padding-bottom: 3rem;
        margin-bottom: 3rem !important;
        border-bottom: 0.5px solid var(--featured-color);
      }
      body.home-page .featured-stats {
        color: var(--featured-color);
      }
    </style>
  <% end %>
<% end %>

<main class="hotwire-native:mt-6">
  <% cache @featured_events do %>
    <% if @featured_events.any? %>
      <section class="splide w-full" aria-label="Featured Events" data-controller="splide">
        <div class="featured-stats w-full pt-8">
          <div class="container hotwire-native:hidden flex flex-col items-center text-center">
            <h2 class="text-2xl font-bold tracking-tight mb-6">On a mission to index all Ruby events</h2>
            <div class="flex flex-wrap gap-4 justify-center items-center text-sm">
              <div class="flex flex-wrap justify-center items-center gap-2 mb-12 lg:mb-6">
                <span class="opacity-80">We have indexed</span>
                <%= link_to events_path, class: "inline-flex items-center px-3 py-1 rounded-full bg-white/20 backdrop-blur-sm font-semibold border hover:bg-white/30 transition-colors", style: "border-color: color-mix(in srgb, var(--featured-color) 25%, transparent);" do %>
                  <%= @events_count %> events
                <% end %>

                <span class="opacity-80">and</span>

                <%= link_to talks_path, class: "inline-flex items-center px-3 py-1 rounded-full bg-white/20 backdrop-blur-sm font-semibold border hover:bg-white/30 transition-colors", style: "border-color: color-mix(in srgb, var(--featured-color) 25%, transparent);" do %>
                  <%= @talks_count %> talks
                <% end %>

                <span class="opacity-80">from</span>

                <%= link_to speakers_path, class: "inline-flex items-center px-3 py-1 rounded-full bg-white/20 backdrop-blur-sm font-semibold border hover:bg-white/30 transition-colors", style: "border-color: color-mix(in srgb, var(--featured-color) 25%, transparent);" do %>
                  <%= @speakers_count %> speakers
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="splide__track">
          <ul class="splide__list">
            <% @featured_events.each_with_index do |event, index| %>
              <li
                class="splide__slide"
                data-featured-color="<%= event.static_metadata.featured_color %>"
                data-featured-background="<%= event.static_metadata.featured_background %>">
                <div class="<%= "hidden" unless index == 0 %>">
                  <%= render partial: "events/featured_home", locals: {event: event} %>
                </div>
              </li>
            <% end %>
          </ul>
        </div>
      </section>
    <% end %>
  <% end %>

  <div class="container">
    <div class="flex flex-col gap-12 mt-12">
      <section class="flex flex-col w-full gap-4">
        <div class="flex items-center justify-between w-full">
          <h2 class="text-primary shrink-0">Latest talks</h2>
          <%= link_to "see all talks", talks_path, class: "link text-right w-full" %>
        </div>

        <div class="grid min-w-full grid-cols-1 gap-8 sm:grid-cols-2 md:grid-cols-3 md:[&>:nth-child(4)]:hidden lg:grid-cols-4 lg:[&>:nth-child(4)]:block">
          <%= render partial: "talks/card", collection: @latest_talks.first(4), as: :talk, cached: true, locals: {back_to: root_path, back_to_title: "Home"} %>
        </div>
      </section>

      <section class="flex flex-col w-full gap-4">
        <div class="flex items-center justify-between w-full">
          <h2 class="text-primary shrink-0">Featured speakers</h2>
          <%= link_to "see all speakers", speakers_path, class: "link text-right w-full" %>
        </div>

        <div class="relative" data-controller="scroll">
          <div class="overflow-x-auto scroll-smooth snap-x snap-mandatory"
               data-scroll-target="container"
               data-action="scroll->scroll#checkScroll">
            <div class="flex pb-4 gap-4">
              <% @featured_speakers.each do |speaker| %>
                <div class="snap-start" data-scroll-target="card">
                  <%= render partial: "speakers/card", locals: {speaker: speaker} %>
                </div>
              <% end %>
            </div>
          </div>
          <div
            class="absolute right-0 top-0 h-full w-24 bg-gradient-to-l from-white to-transparent pointer-events-none"
            data-scroll-target="gradient"></div>
        </div>
      </section>

      <section class="flex flex-col w-full gap-4">
        <div class="flex items-center justify-between w-full">
          <h2 class="text-primary shrink-0">Latest events</h2>
          <%= link_to "see all events", events_path, class: "link text-right w-full" %>
        </div>
        <div class="grid min-w-full grid-cols-1 gap-8 sm:grid-cols-2 md:grid-cols-3 md:[&>:nth-child(4)]:hidden lg:grid-cols-4 lg:[&>:nth-child(4)]:block">
          <%= cache @latest_events do %>
            <%= render partial: "events/card", collection: @latest_events, as: :event, cached: true %>
          <% end %>
        </div>
      </section>

      <% if @recommended_talks.present? %>
        <section class="flex flex-col w-full gap-4">
          <div class="flex items-center justify-between w-full">
            <h2 class="text-primary shrink-0">Recommended for you</h2>
            <%= link_to "see all recommendations", recommendations_path, class: "link text-right w-full" %>
          </div>
          <div class="grid min-w-full grid-cols-1 gap-8 sm:grid-cols-2 md:grid-cols-3 md:[&>:nth-child(4)]:hidden lg:grid-cols-4 lg:[&>:nth-child(4)]:block">
            <%= render partial: "talks/card", collection: @recommended_talks, as: :talk, cached: true, locals: {back_to: root_path, back_to_title: "Home"} %>
          </div>
        </section>
      <% end %>

      <% if @featured_sponsors.present? %>
        <section class="flex flex-col w-full gap-4">
          <div class="flex items-center justify-between w-full">
            <h2 class="text-primary shrink-0">Featured sponsors</h2>
            <%= link_to "see all sponsors", sponsors_path, class: "link text-right w-full" %>
          </div>

          <div class="relative" data-controller="scroll">
            <div class="overflow-x-auto scroll-smooth snap-x snap-mandatory" data-scroll-target="container" data-action="scroll->scroll#checkScroll">
              <div class="flex pb-4 gap-4">
                <% @featured_sponsors.each do |sponsor| %>
                  <div class="snap-start" data-scroll-target="card">
                    <%= render partial: "sponsors/card", locals: {sponsor: sponsor} %>
                  </div>
                <% end %>
              </div>
            </div>

            <div class="absolute right-0 top-0 h-full w-24 bg-gradient-to-l from-white to-transparent pointer-events-none" data-scroll-target="gradient"></div>
          </div>
        </section>
      <% end %>
    </div>
  </div>
</main>
